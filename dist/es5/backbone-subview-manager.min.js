!function(e,i){if("function"==typeof define&&define.amd)define("BackboneSubviewManager",["exports","underscore","backbone"],i);else if("undefined"!=typeof exports)i(exports,require("underscore"),require("backbone"));else{var t={};i(t,e._,e.Backbone),e.BackboneSubviewManager=t}}(this,function(e,i,t){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}function n(e){return d(e)||l(e)}function u(e){return _(e)?e:[e]}function o(e){return n(e)?null:b(e)?e:e.cid||null}e.__esModule=!0,e.CompositeView=e.CompositeViewMixin=undefined;var r=s(i),a=s(t),f=r["default"].has,h=r["default"].forEach,c=r["default"].keys,w=r["default"].result,b=r["default"].isString,_=r["default"].isArray,d=r["default"].isNull,l=r["default"].isUndefined,v="undefined"!=typeof Map?Map:function(){var e={};return function(){function i(){!function(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this._o={},this.size=0}return i.prototype.has=function(i){return f(this._o,i)&&this._o[i]!==e},i.prototype.get=function(e){return this.has(e)?this._o[e]:undefined},i.prototype.set=function(e,i){this.has(e)||this.size++,this._o[e]=i},i.prototype.clear=function(){this._o={},this.size=0},i.prototype["delete"]=function(i){f(this._o,i)&&(this._o[i]=e,this.size--)},i.prototype.forEach=function(i,t){var s=this;this.size>0&&h(c(this._o),function(n){s._o[n]!==e&&i.call(t,s._o[n],n,s)})},i}()}(),V={initializeSubViews:function(){return this._subviews=new v,this},addSubViews:function(e){var i=this,t=u(e);return t.length>0&&(this._ensureSubViews(),h(t,function(e){i._addSubView(e)})),this},initSubView:function(e,i){var t=new e(i);return this._ensureSubViews(),this._addSubView(t),t},attachSubViews:function(e,i){var t=this,s=this.$(e);return s.length>0&&(this._ensureSubViews(),h(s,function(e,s){t._addSubView(i({el:e,idx:s}))})),this},getSubView:function(e){if(!this._hasSubViews())return null;var i=o(e);return(d(i)?null:this._subviews.get(i))||null},getSubViews:function(){var e=[];return this._hasSubViews()&&this._subviews.forEach(function(i){e.push(i)}),e},removeSubViews:function(e){return this._hasSubViews()&&(n(e)?this._clearSubViews():this._removeSubViews(e)),this},_clearSubViews:function(){var e=this;this._subviews.forEach(function(i){e._removeSubView(i)}),this._subviews.clear()},_removeSubViews:function(e){var i=this,t=u(e);h(t,function(e){var t=o(e);i._subviews.has(t)&&(i._removeSubView(i._subviews.get(t)),i._subviews["delete"](t))})},_hasSubViews:function(){return!!this._subviews&&w(this._subviews,"size")>0},_removeSubView:function(e){this.stopListening(e),e.remove()},_addSubView:function(e){var i=this,t=e.cid;this._subviews.set(t,e),this.listenToOnce(e,"remove dispose",function(){i._removeSubView(e),i._subviews["delete"](t)})},_ensureSubViews:function(){this._subviews||this.initializeSubViews()}},S=a["default"].View.extend(V).extend({remove:function(){return this.removeSubViews(),a["default"].View.prototype.remove.call(this)}});e.CompositeViewMixin=V,e.CompositeView=S});